C51 COMPILER V9.54   KEY                                                                   10/01/2024 15:57:44 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\OUTPUT\key.obj
COMPILER INVOKED BY: E:\Keil_C51\C51\BIN\C51.EXE ..\SOURCE\key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\SOURCE) DEBUG OBJECT
                    -EXTEND PRINT(..\LISTING\key.lst) TABS(2) OBJECT(..\OUTPUT\key.obj)

line level    source

   1          /*******************************************************
   2          file.name : key.c
   3          version : 1.1
   4          description : 存放了一些用于按键的功能函数
   5          *******************************************************/
   6          
   7          #include "key.h"
   8          #include "led.h"
   9          #include <reg51.h>
  10          
  11          // 定义按键的状态
  12          #define       KEY1_ON       0x1   //0001
  13          #define       KEY2_ON       0x2   //0010
  14          #define       KEY3_ON       0x4   //0100
  15          #define       KEY4_ON       0x8   //1000
  16          
  17          // 定义按键io口
  18          sbit key1 = P2^0;
  19          sbit key2 = P2^1;
  20          sbit key3 = P2^2;
  21          sbit key4 = P2^3;
  22          
  23          // 定义变量
  24          unsigned char key_state = 0x0;
  25          
  26          // 扫描指定的io口电平，查看开关的开合
  27          // 输出的是一个四位二进制数，其对应的二进制数就是开关开合的状态
  28          // 从低位到高位是开关1到4
  29          // 按键的扫描有两个模式:
  30          // MODEL1为按钮模式，按下为1，松开为0
  31          // MODEL2为开关模式，按键切换1和0的状态
  32          // 可以使用WAITING_RELEASE来设置是否有松手等待,不使用就传入0
  33          unsigned char Key_State_Scan(unsigned char model,unsigned char wait_mod)
  34          {
  35   1        unsigned char key_state_1 = 0x0;
  36   1        if(model == MODEL1)   //模式1，使用局部变量
  37   1        {
  38   2          if(!key1 || !key2 || !key3 || !key4)  // 检测是否有按键被按下
  39   2          {
  40   3            DelayXms(10);   //消抖
  41   3            if(!key1)
  42   3            {
  43   4              key_state_1 = key_state_1 + KEY1_ON;  //按键赋值
  44   4            }
  45   3            if(!key2)
  46   3            {
  47   4              key_state_1 = key_state_1 + KEY2_ON;
  48   4            }
  49   3            if(!key3)
  50   3            {
  51   4              key_state_1 = key_state_1 + KEY3_ON;
  52   4            }
  53   3            if(!key4)
  54   3            {
C51 COMPILER V9.54   KEY                                                                   10/01/2024 15:57:44 PAGE 2   

  55   4              key_state_1 = key_state_1 + KEY4_ON;
  56   4            }
  57   3          }
  58   2          key_state = key_state_1;
  59   2          if(wait_mod == WAITING_RELEASE)
  60   2            {
  61   3              while(!key1 || !key2 || !key3 || !key4);
  62   3            }    //松手等待
  63   2        }
  64   1        
  65   1        else if(model == MODEL2)    //模式2，使用静态变量
  66   1        {
  67   2          if(!key1 || !key2 || !key3 || !key4)  // 检测是否有按键被按下
  68   2          {
  69   3            DelayXms(10);   //消抖
  70   3            if(!key1)
  71   3            {
  72   4              key_state = key_state ^ (1 << 0);  //按键赋值，按位取反
  73   4            }
  74   3            if(!key2)
  75   3            {
  76   4              key_state = key_state ^ (1 << 1);
  77   4            }
  78   3            if(!key3)
  79   3            {
  80   4              key_state = key_state ^ (1 << 2);
  81   4            }
  82   3            if(!key4)
  83   3            {
  84   4              key_state = key_state ^ (1 << 3);
  85   4            }
  86   3          }
  87   2          if(wait_mod == WAITING_RELEASE)
  88   2            {
  89   3              while(!key1 || !key2 || !key3 || !key4);
  90   3            }    //松手等待
  91   2        }
  92   1      
  93   1        return key_state;
  94   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    154    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
