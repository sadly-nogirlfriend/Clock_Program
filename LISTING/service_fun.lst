C51 COMPILER V9.54   SERVICE_FUN                                                           10/12/2024 12:33:57 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SERVICE_FUN
OBJECT MODULE PLACED IN ..\OUTPUT\service_fun.obj
COMPILER INVOKED BY: E:\Keil_C51\C51\BIN\C51.EXE ..\SOURCE\service_fun.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\SOURCE) DEBU
                    -G OBJECTEXTEND PRINT(..\LISTING\service_fun.lst) TABS(2) OBJECT(..\OUTPUT\service_fun.obj)

line level    source

   1          /*******************************************************
   2          file.name : service_fun.c
   3          version : 1.1
   4          description : 存放了一些用于程序运行的功能函数
   5          *******************************************************/
   6          
   7          // 包含的头文件
   8          #include "service_fun.h"
   9          #include <reg51.h>
  10          #include "key.h"
  11          #include "led.h"
  12          
  13          // 宏定义
  14          #define       WINDOW1       2
  15          #define       WINDOW2       3
  16          #define       WINDOW3       4
  17          
  18          // 定义的变量
  19          int min_time = 0; 
  20          unsigned int count1 = 0;  //用于计数，窗口1
  21          unsigned int count2 = 0;  //用于计数，窗口2
  22          unsigned int count3 = 0;  //用于计数，窗口3
  23          unsigned char windows = WINDOW1;  // 用于窗口标记，默认为窗口1
  24          
  25          // 该函数用于数字转字符串,将四位整数转化为字符串
  26          // 注意数字为无符号整数，一定要大于0
  27          unsigned char* num2str(unsigned int num)
  28          {
  29   1        static unsigned char str[] = "0000";
  30   1        str[3] = num%10+'0';
  31   1        str[2] = (num/10)%10+'0';
  32   1        str[1] = (num/100)%10+'0';
  33   1        str[0] = (num/1000)%10+'0';
  34   1        return str;
  35   1      }
  36          
  37          // 该函数用于显示对应窗口
  38          void display_windows()
  39          {
  40   1        switch (windows)
  41   1        {
  42   2        case WINDOW1:
  43   2          display_str_once(num2str(count1));
  44   2          break;
  45   2        case WINDOW2:
  46   2          display_str_once(num2str(count2));
  47   2          break;
  48   2        case WINDOW3:
  49   2          display_str_once(num2str(count3));
  50   2          break;
  51   2        default:
  52   2          display_str_once("----");
  53   2          break;
  54   2        }
C51 COMPILER V9.54   SERVICE_FUN                                                           10/12/2024 12:33:57 PAGE 2   

  55   1      }
  56          
  57          // 窗口分配：window1 用于时钟
  58          void clock() interrupt 1
  59          {
  60   1        // 标志位清零
  61   1        TF0 = 0;
  62   1        // 定时60ms
  63   1        TL0 = (65536 - 60000)%256;
  64   1        TH0 = (65536 - 60000)/256;
  65   1        min_time++;
  66   1        if(min_time == 1000)
  67   1        {
  68   2          count1++;
  69   2          min_time = 0;
  70   2        }
  71   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    183    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
